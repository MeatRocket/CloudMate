"use strict";
exports.__esModule = true;
var config_1 = require("./config");
var chokidar = require("chokidar");
var gulp = require('gulp');
var gulpLess = require('gulp-less');
var gulpRename = require('gulp-rename');
var gulpConcat = require("gulp-concat");
var gulpTs = require("gulp-typescript");
var gulpSourcemaps = require("gulp-sourcemaps");
var gulpUglify = require('gulp-uglify');
var merge2 = require('merge2');
var gulpCleanCSS = require('gulp-clean-css');
var gulpFilter = require('gulp-filter-each');
var path = require('path');
var bundle = function (files, build) {
    var process = [];
    var groupFilesExtention = '';
    var groupedFiles = [];
    files.forEach(function (file) {
        var fileExtention = file.split('.').pop().toLowerCase();
        if (fileExtention !== groupFilesExtention) {
            if (groupedFiles.length > 0) {
                process.push(compile(groupedFiles, groupFilesExtention, build));
                groupedFiles = [];
            }
            groupFilesExtention = fileExtention;
        }
        groupedFiles.push(file);
    });
    if (groupedFiles.length > 0)
        process.push(compile(groupedFiles, groupFilesExtention, build));
    var stream = merge2();
    process.forEach(function (p) {
        stream.add(p);
    });
    return stream;
};
var compile = function (files, extention, build) {
    var process = gulp.src(files);
    switch (extention) {
        case 'css':
            return process.pipe(gulpConcat('empty'));
        case 'less':
            if (build.css.sourceMap)
                process = process.pipe(gulpSourcemaps.init());
            process = process.pipe(gulpLess());
            if (build.css.sourceMap)
                process = process.pipe(gulpSourcemaps.write());
            return process.pipe(gulpConcat('empty'));
        case 'ts':
            if (build.js.sourceMap)
                process = process.pipe(gulpSourcemaps.init());
            process = process.pipe(gulpTs());
            if (build.js.sourceMap)
                process = process.pipe(gulpSourcemaps.write());
            return process.pipe(gulpConcat('empty'));
        case 'd.ts':
            return process
                .pipe(gulpTs(build.ts.compilerOptions));
    }
    return process;
};
var createTypeScriptDeclaration = function (files, outputDirectory, outputFileName, build) {
    var typescriptDeclarations = [];
    files.forEach(function (file) {
        var fileExtention = file.split('.').pop().toLowerCase();
        if (fileExtention === 'ts')
            typescriptDeclarations.push(file);
    });
    if (typescriptDeclarations.length > 0)
        compile(typescriptDeclarations, 'd.ts', build)
            .pipe(gulpFilter(function (content, filepath) { return filepath.toLowerCase().endsWith('.d.ts'); }))
            .pipe(gulpConcat('empty'))
            .pipe(gulpRename({
            basename: outputFileName.replace('.js', ''),
            suffix: '.d',
            extname: '.ts'
        }))
            .pipe(gulp.dest(outputDirectory));
};
var allWatchers = [];
exports.watch = function (builds) {
    if (builds === undefined || (builds !== null && builds.length === 0))
        builds = ['dev'];
    var configWatcher = chokidar.watch('mateconfig.json', { persistent: true })
        .on('change', function (event, path) {
        allWatchers.forEach(function (watcher) {
            watcher.close();
        });
        allWatchers = [];
        exports.watch(builds);
    });
    allWatchers.push(configWatcher);
    var config = config_1.MateConfig.get();
    config.files.forEach(function (file) {
        file.builds.forEach(function (buildName) {
            if (builds === null || builds.indexOf(buildName) !== -1) {
                var watch_1 = chokidar.watch(file.input, { persistent: true })
                    .on('change', function (event, path) {
                    runFiles(config, file, [buildName]);
                });
                allWatchers.push(watch_1);
            }
        });
    });
    exports.runBuild(builds);
};
exports.runBuild = function (builds) {
    var config = config_1.MateConfig.get();
    config.files.forEach(function (file) {
        runFiles(config, file, builds);
    });
};
var runFiles = function (config, file, builds) {
    if (builds === undefined || (builds !== null && builds.length === 0))
        builds = ['dev'];
    file.output.forEach(function (output) {
        var outputExtention = output.split('.').pop().toLowerCase();
        var outputFileName = output.replace(/^.*[\\\/]/, '');
        file.builds.forEach(function (buildName) {
            if (builds !== null && builds.indexOf(buildName) === -1)
                return;
            var build = config.getBuild(buildName);
            var outputDirectory = build.outDir ? build.outDir : path.dirname(output);
            if (build.outDirVersioning)
                outputDirectory += '/' + config.getOutDirVersion();
            if (build.outDirName)
                outputDirectory += '/' + config.getOutDirName();
            switch (outputExtention) {
                case 'css':
                    if (build.css.outDirSuffix)
                        outputDirectory += '/' + build.css.outDirSuffix;
                    break;
                case 'js':
                    if (build.js.outDirSuffix)
                        outputDirectory += '/' + build.js.outDirSuffix;
                    break;
            }
            if (build.ts.compilerOptions.declaration === true)
                createTypeScriptDeclaration(file.input, outputDirectory, outputFileName, build);
            var process = bundle(file.input, build)
                .pipe(gulpConcat('empty'))
                .pipe(gulpRename(outputFileName))
                .pipe(gulp.dest(outputDirectory));
            switch (outputExtention) {
                case 'css':
                    if (build.css.minify) {
                        process.pipe(gulpCleanCSS())
                            .pipe(gulpRename({ suffix: ".min" }))
                            .pipe(gulp.dest(outputDirectory));
                    }
                    break;
                case 'js':
                    if (build.js.minify) {
                        process.pipe(gulpUglify())
                            .pipe(gulpRename({ suffix: ".min" }))
                            .pipe(gulp.dest(outputDirectory));
                    }
                    break;
            }
        });
    });
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBNEY7QUFDNUYsbUNBQXNDO0FBRXRDLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM3QixJQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDdEMsSUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzFDLElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUMxQyxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUMxQyxJQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUNsRCxJQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDMUMsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2pDLElBQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQy9DLElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQy9DLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUU3QixJQUFNLE1BQU0sR0FBRyxVQUFTLEtBQWUsRUFBRSxLQUFzQjtJQUUzRCxJQUFNLE9BQU8sR0FBVSxFQUFFLENBQUM7SUFFMUIsSUFBSSxtQkFBbUIsR0FBRyxFQUFFLENBQUM7SUFDN0IsSUFBSSxZQUFZLEdBQWEsRUFBRSxDQUFDO0lBRWhDLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBQyxJQUFJO1FBRWYsSUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUUxRCxJQUFJLGFBQWEsS0FBSyxtQkFBbUIsRUFBQztZQUV0QyxJQUFJLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUMzQjtnQkFDSSxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDaEUsWUFBWSxHQUFHLEVBQUUsQ0FBQTthQUNwQjtZQUVELG1CQUFtQixHQUFHLGFBQWEsQ0FBQztTQUN2QztRQUVELFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFNUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUVyRSxJQUFNLE1BQU0sR0FBRyxNQUFNLEVBQUUsQ0FBQztJQUV4QixPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2YsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLE1BQU0sQ0FBQztBQUNqQixDQUFDLENBQUE7QUFFRCxJQUFNLE9BQU8sR0FBRyxVQUFTLEtBQWUsRUFBRSxTQUFpQixFQUFFLEtBQXNCO0lBRS9FLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFOUIsUUFBUSxTQUFTLEVBQUM7UUFDZCxLQUFLLEtBQUs7WUFDTixPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFFN0MsS0FBSyxNQUFNO1lBRVAsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLFNBQVM7Z0JBQ25CLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRWxELE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFFbkMsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLFNBQVM7Z0JBQ25CLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBRW5ELE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUU3QyxLQUFLLElBQUk7WUFFTCxJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUMsU0FBUztnQkFDbEIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7WUFFbEQsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUVqQyxJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUMsU0FBUztnQkFDbEIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7WUFFbkQsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBRTdDLEtBQUssTUFBTTtZQUNQLE9BQU8sT0FBTztpQkFDTCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztLQUN2RDtJQUVELE9BQU8sT0FBTyxDQUFDO0FBQ25CLENBQUMsQ0FBQTtBQUVELElBQU0sMkJBQTJCLEdBQUcsVUFBUyxLQUFnQixFQUFFLGVBQXVCLEVBQUUsY0FBc0IsRUFBRSxLQUFzQjtJQUVsSSxJQUFNLHNCQUFzQixHQUFhLEVBQUUsQ0FBQztJQUU1QyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSTtRQUNmLElBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFMUQsSUFBSSxhQUFhLEtBQUssSUFBSTtZQUN0QixzQkFBc0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLHNCQUFzQixDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ2pDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDO2FBQ3pDLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBQyxPQUFPLEVBQUUsUUFBZ0IsSUFBSyxPQUFBLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQXhDLENBQXdDLENBQUMsQ0FBQzthQUN6RixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUM7WUFDYixRQUFRLEVBQUUsY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDO1lBQzNDLE1BQU0sRUFBRSxJQUFJO1lBQ1osT0FBTyxFQUFFLEtBQUs7U0FDakIsQ0FBQyxDQUFDO2FBQ0YsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztBQUM5QyxDQUFDLENBQUE7QUFFRCxJQUFJLFdBQVcsR0FBeUIsRUFBRSxDQUFDO0FBRTlCLFFBQUEsS0FBSyxHQUFHLFVBQVMsTUFBaUI7SUFFM0MsSUFBSSxNQUFNLEtBQUssU0FBUyxJQUFJLENBQUMsTUFBTSxLQUFLLElBQUksSUFBSSxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztRQUNoRSxNQUFNLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUVyQixJQUFNLGFBQWEsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBQyxDQUFDO1NBQzNDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBQyxLQUFLLEVBQUUsSUFBWTtRQUU5QixXQUFXLENBQUMsT0FBTyxDQUFDLFVBQUMsT0FBMkI7WUFFNUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3BCLENBQUMsQ0FBQyxDQUFDO1FBRUgsV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUVqQixhQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbEIsQ0FBQyxDQUFDLENBQUM7SUFFbkMsV0FBVyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUVoQyxJQUFNLE1BQU0sR0FBRyxtQkFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBRWhDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSTtRQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFDLFNBQVM7WUFFMUIsSUFBSSxNQUFNLEtBQUssSUFBSSxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7Z0JBRXJELElBQU0sT0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUMsQ0FBQztxQkFDcEMsRUFBRSxDQUFDLFFBQVEsRUFBRSxVQUFDLEtBQUssRUFBRSxJQUFZO29CQUM5QixRQUFRLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hDLENBQUMsQ0FBQyxDQUFDO2dCQUUzQixXQUFXLENBQUMsSUFBSSxDQUFDLE9BQUssQ0FBQyxDQUFDO2FBQzNCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILGdCQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDckIsQ0FBQyxDQUFBO0FBRVksUUFBQSxRQUFRLEdBQUcsVUFBUyxNQUFpQjtJQUU5QyxJQUFNLE1BQU0sR0FBRyxtQkFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBRWhDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSTtRQUV0QixRQUFRLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNuQyxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQTtBQUVELElBQU0sUUFBUSxHQUFHLFVBQVMsTUFBa0IsRUFBRSxJQUFvQixFQUFFLE1BQWlCO0lBRWpGLElBQUksTUFBTSxLQUFLLFNBQVMsSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7UUFDaEUsTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBQyxNQUFNO1FBRXZCLElBQU0sZUFBZSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDOUQsSUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFdkQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBQyxTQUFTO1lBRTFCLElBQUksTUFBTSxLQUFLLElBQUksSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbkQsT0FBTztZQUVYLElBQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFekMsSUFBSSxlQUFlLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUV6RSxJQUFJLEtBQUssQ0FBQyxnQkFBZ0I7Z0JBQ3RCLGVBQWUsSUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFdkQsSUFBSSxLQUFLLENBQUMsVUFBVTtnQkFDaEIsZUFBZSxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFcEQsUUFBUSxlQUFlLEVBQUU7Z0JBRXJCLEtBQUssS0FBSztvQkFFTixJQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsWUFBWTt3QkFDdEIsZUFBZSxJQUFJLEdBQUcsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztvQkFFcEQsTUFBTTtnQkFFVixLQUFLLElBQUk7b0JBRUwsSUFBSSxLQUFLLENBQUMsRUFBRSxDQUFDLFlBQVk7d0JBQ3JCLGVBQWUsSUFBSSxHQUFHLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUM7b0JBRW5ELE1BQU07YUFDYjtZQUVELElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxlQUFlLENBQUMsV0FBVyxLQUFLLElBQUk7Z0JBQzdDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUVwRixJQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUM7aUJBQ3hDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7aUJBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7WUFFbEMsUUFBUSxlQUFlLEVBQUU7Z0JBRXJCLEtBQUssS0FBSztvQkFFTixJQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFO3dCQUVsQixPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDOzZCQUMzQixJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUMsTUFBTSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7NkJBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7cUJBQ3JDO29CQUNELE1BQU07Z0JBRVYsS0FBSyxJQUFJO29CQUVMLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUU7d0JBRWpCLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7NkJBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQzs2QkFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztxQkFDckM7b0JBQ0QsTUFBTTthQUNiO1FBRUwsQ0FBQyxDQUFDLENBQUM7SUFFUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWF0ZUNvbmZpZywgTWF0ZUNvbmZpZ0NTU0NvbmZpZywgTWF0ZUNvbmZpZ0J1aWxkLCBNYXRlQ29uZmlnRmlsZSB9IGZyb20gXCIuL2NvbmZpZ1wiO1xyXG5pbXBvcnQgY2hva2lkYXIgPSByZXF1aXJlKCdjaG9raWRhcicpO1xyXG5cclxuY29uc3QgZ3VscCA9IHJlcXVpcmUoJ2d1bHAnKTtcclxuY29uc3QgZ3VscExlc3MgPSByZXF1aXJlKCdndWxwLWxlc3MnKTtcclxuY29uc3QgZ3VscFJlbmFtZSA9IHJlcXVpcmUoJ2d1bHAtcmVuYW1lJyk7XHJcbmNvbnN0IGd1bHBDb25jYXQgPSByZXF1aXJlKFwiZ3VscC1jb25jYXRcIik7XHJcbmNvbnN0IGd1bHBUcyA9IHJlcXVpcmUoXCJndWxwLXR5cGVzY3JpcHRcIik7XHJcbmNvbnN0IGd1bHBTb3VyY2VtYXBzID0gcmVxdWlyZShcImd1bHAtc291cmNlbWFwc1wiKTtcclxuY29uc3QgZ3VscFVnbGlmeSA9IHJlcXVpcmUoJ2d1bHAtdWdsaWZ5Jyk7XHJcbmNvbnN0IG1lcmdlMiA9IHJlcXVpcmUoJ21lcmdlMicpO1xyXG5jb25zdCBndWxwQ2xlYW5DU1MgPSByZXF1aXJlKCdndWxwLWNsZWFuLWNzcycpO1xyXG5jb25zdCBndWxwRmlsdGVyID0gcmVxdWlyZSgnZ3VscC1maWx0ZXItZWFjaCcpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5cclxuY29uc3QgYnVuZGxlID0gZnVuY3Rpb24oZmlsZXM6IHN0cmluZ1tdLCBidWlsZDogTWF0ZUNvbmZpZ0J1aWxkKTogYW55IHtcclxuXHJcbiAgICBjb25zdCBwcm9jZXNzOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgIGxldCBncm91cEZpbGVzRXh0ZW50aW9uID0gJyc7XHJcbiAgICBsZXQgZ3JvdXBlZEZpbGVzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgXHJcbiAgICBmaWxlcy5mb3JFYWNoKChmaWxlKSA9PntcclxuXHJcbiAgICAgICAgY29uc3QgZmlsZUV4dGVudGlvbiA9IGZpbGUuc3BsaXQoJy4nKS5wb3AoKS50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgICAgICBpZiAoZmlsZUV4dGVudGlvbiAhPT0gZ3JvdXBGaWxlc0V4dGVudGlvbil7XHJcblxyXG4gICAgICAgICAgICBpZiAoZ3JvdXBlZEZpbGVzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3MucHVzaChjb21waWxlKGdyb3VwZWRGaWxlcywgZ3JvdXBGaWxlc0V4dGVudGlvbiwgYnVpbGQpKTtcclxuICAgICAgICAgICAgICAgIGdyb3VwZWRGaWxlcyA9IFtdXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGdyb3VwRmlsZXNFeHRlbnRpb24gPSBmaWxlRXh0ZW50aW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ3JvdXBlZEZpbGVzLnB1c2goZmlsZSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGdyb3VwZWRGaWxlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgIHByb2Nlc3MucHVzaChjb21waWxlKGdyb3VwZWRGaWxlcywgZ3JvdXBGaWxlc0V4dGVudGlvbiwgYnVpbGQpKTtcclxuXHJcbiAgIGNvbnN0IHN0cmVhbSA9IG1lcmdlMigpO1xyXG5cclxuICAgcHJvY2Vzcy5mb3JFYWNoKChwKSA9PntcclxuICAgIHN0cmVhbS5hZGQocCk7XHJcbiAgIH0pO1xyXG4gICAgXHJcbiAgIHJldHVybiBzdHJlYW07XHJcbn1cclxuXHJcbmNvbnN0IGNvbXBpbGUgPSBmdW5jdGlvbihmaWxlczogc3RyaW5nW10sIGV4dGVudGlvbjogc3RyaW5nLCBidWlsZDogTWF0ZUNvbmZpZ0J1aWxkKTogYW55IHtcclxuXHJcbiAgICBsZXQgcHJvY2VzcyA9IGd1bHAuc3JjKGZpbGVzKTtcclxuXHJcbiAgICBzd2l0Y2ggKGV4dGVudGlvbil7XHJcbiAgICAgICAgY2FzZSAnY3NzJzpcclxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3MucGlwZShndWxwQ29uY2F0KCdlbXB0eScpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnbGVzcyc6XHJcblxyXG4gICAgICAgICAgICBpZiAoYnVpbGQuY3NzLnNvdXJjZU1hcClcclxuICAgICAgICAgICAgICAgIHByb2Nlc3MgPSBwcm9jZXNzLnBpcGUoZ3VscFNvdXJjZW1hcHMuaW5pdCgpKTtcclxuXHJcbiAgICAgICAgICAgIHByb2Nlc3MgPSBwcm9jZXNzLnBpcGUoZ3VscExlc3MoKSk7ICAgIFxyXG5cclxuICAgICAgICAgICAgaWYgKGJ1aWxkLmNzcy5zb3VyY2VNYXApXHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzID0gcHJvY2Vzcy5waXBlKGd1bHBTb3VyY2VtYXBzLndyaXRlKCkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3MucGlwZShndWxwQ29uY2F0KCdlbXB0eScpKTtcclxuICAgIFxyXG4gICAgICAgIGNhc2UgJ3RzJzpcclxuXHJcbiAgICAgICAgICAgIGlmIChidWlsZC5qcy5zb3VyY2VNYXApXHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzID0gcHJvY2Vzcy5waXBlKGd1bHBTb3VyY2VtYXBzLmluaXQoKSk7XHJcblxyXG4gICAgICAgICAgICBwcm9jZXNzID0gcHJvY2Vzcy5waXBlKGd1bHBUcygpKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChidWlsZC5qcy5zb3VyY2VNYXApXHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzID0gcHJvY2Vzcy5waXBlKGd1bHBTb3VyY2VtYXBzLndyaXRlKCkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3MucGlwZShndWxwQ29uY2F0KCdlbXB0eScpKTtcclxuXHJcbiAgICAgICAgY2FzZSAnZC50cyc6XHJcbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgLnBpcGUoZ3VscFRzKGJ1aWxkLnRzLmNvbXBpbGVyT3B0aW9ucykpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwcm9jZXNzO1xyXG59XHJcblxyXG5jb25zdCBjcmVhdGVUeXBlU2NyaXB0RGVjbGFyYXRpb24gPSBmdW5jdGlvbihmaWxlczogc3RyaW5nIFtdLCBvdXRwdXREaXJlY3Rvcnk6IHN0cmluZywgb3V0cHV0RmlsZU5hbWU6IHN0cmluZywgYnVpbGQ6IE1hdGVDb25maWdCdWlsZCk6IHZvaWQge1xyXG5cclxuICAgIGNvbnN0IHR5cGVzY3JpcHREZWNsYXJhdGlvbnM6IHN0cmluZ1tdID0gW107XHJcbiAgICBcclxuICAgIGZpbGVzLmZvckVhY2goKGZpbGUpID0+IHtcclxuICAgICAgICBjb25zdCBmaWxlRXh0ZW50aW9uID0gZmlsZS5zcGxpdCgnLicpLnBvcCgpLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgICAgIGlmIChmaWxlRXh0ZW50aW9uID09PSAndHMnKVxyXG4gICAgICAgICAgICB0eXBlc2NyaXB0RGVjbGFyYXRpb25zLnB1c2goZmlsZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAodHlwZXNjcmlwdERlY2xhcmF0aW9ucy5sZW5ndGggPiAwKVxyXG4gICAgICAgIGNvbXBpbGUodHlwZXNjcmlwdERlY2xhcmF0aW9ucywgJ2QudHMnLCBidWlsZClcclxuICAgICAgICAgICAgLnBpcGUoZ3VscEZpbHRlcigoY29udGVudCwgZmlsZXBhdGg6IHN0cmluZykgPT4gZmlsZXBhdGgudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnLmQudHMnKSkpXHJcbiAgICAgICAgICAgIC5waXBlKGd1bHBDb25jYXQoJ2VtcHR5JykpXHJcbiAgICAgICAgICAgIC5waXBlKGd1bHBSZW5hbWUoe1xyXG4gICAgICAgICAgICAgICAgYmFzZW5hbWU6IG91dHB1dEZpbGVOYW1lLnJlcGxhY2UoJy5qcycsICcnKSxcclxuICAgICAgICAgICAgICAgIHN1ZmZpeDogJy5kJyxcclxuICAgICAgICAgICAgICAgIGV4dG5hbWU6ICcudHMnXHJcbiAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgICAucGlwZShndWxwLmRlc3Qob3V0cHV0RGlyZWN0b3J5KSk7XHJcbn1cclxuXHJcbmxldCBhbGxXYXRjaGVyczogY2hva2lkYXIuRlNXYXRjaGVyW10gPSBbXTtcclxuXHJcbmV4cG9ydCBjb25zdCB3YXRjaCA9IGZ1bmN0aW9uKGJ1aWxkcz86IHN0cmluZ1tdKSB7XHJcblxyXG4gICAgaWYgKGJ1aWxkcyA9PT0gdW5kZWZpbmVkIHx8IChidWlsZHMgIT09IG51bGwgJiYgYnVpbGRzLmxlbmd0aCA9PT0gMCkpXHJcbiAgICAgICAgYnVpbGRzID0gWydkZXYnXTtcclxuXHJcbiAgICBjb25zdCBjb25maWdXYXRjaGVyID0gY2hva2lkYXIud2F0Y2goJ21hdGVjb25maWcuanNvbicsIHsgcGVyc2lzdGVudDogdHJ1ZX0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbignY2hhbmdlJywgKGV2ZW50LCBwYXRoOiBzdHJpbmcpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxXYXRjaGVycy5mb3JFYWNoKCh3YXRjaGVyOiBjaG9raWRhci5GU1dhdGNoZXIpID0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2F0Y2hlci5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsV2F0Y2hlcnMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXRjaChidWlsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICBhbGxXYXRjaGVycy5wdXNoKGNvbmZpZ1dhdGNoZXIpO1xyXG5cclxuICAgIGNvbnN0IGNvbmZpZyA9IE1hdGVDb25maWcuZ2V0KCk7XHJcblxyXG4gICAgY29uZmlnLmZpbGVzLmZvckVhY2goKGZpbGUpID0+IHtcclxuICAgICAgICBmaWxlLmJ1aWxkcy5mb3JFYWNoKChidWlsZE5hbWUpID0+IHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChidWlsZHMgPT09IG51bGwgfHwgYnVpbGRzLmluZGV4T2YoYnVpbGROYW1lKSAhPT0gLTEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB3YXRjaCA9IGNob2tpZGFyLndhdGNoKGZpbGUuaW5wdXQsIHsgcGVyc2lzdGVudDogdHJ1ZX0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oJ2NoYW5nZScsIChldmVudCwgcGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVuRmlsZXMoY29uZmlnLCBmaWxlLCBbYnVpbGROYW1lXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBhbGxXYXRjaGVycy5wdXNoKHdhdGNoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJ1bkJ1aWxkKGJ1aWxkcyk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBydW5CdWlsZCA9IGZ1bmN0aW9uKGJ1aWxkcz86IHN0cmluZ1tdKSB7XHJcblxyXG4gICAgY29uc3QgY29uZmlnID0gTWF0ZUNvbmZpZy5nZXQoKTtcclxuXHJcbiAgICBjb25maWcuZmlsZXMuZm9yRWFjaCgoZmlsZSk6IHZvaWQgPT4ge1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJ1bkZpbGVzKGNvbmZpZywgZmlsZSwgYnVpbGRzKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jb25zdCBydW5GaWxlcyA9IGZ1bmN0aW9uKGNvbmZpZzogTWF0ZUNvbmZpZywgZmlsZTogTWF0ZUNvbmZpZ0ZpbGUsIGJ1aWxkcz86IHN0cmluZ1tdKSB7XHJcbiAgICBcclxuICAgIGlmIChidWlsZHMgPT09IHVuZGVmaW5lZCB8fCAoYnVpbGRzICE9PSBudWxsICYmIGJ1aWxkcy5sZW5ndGggPT09IDApKVxyXG4gICAgICAgIGJ1aWxkcyA9IFsnZGV2J107XHJcblxyXG4gICAgZmlsZS5vdXRwdXQuZm9yRWFjaCgob3V0cHV0KSA9PiB7XHJcbiAgICBcclxuICAgICAgICBjb25zdCBvdXRwdXRFeHRlbnRpb24gPSBvdXRwdXQuc3BsaXQoJy4nKS5wb3AoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGNvbnN0IG91dHB1dEZpbGVOYW1lID0gb3V0cHV0LnJlcGxhY2UoL14uKltcXFxcXFwvXS8sICcnKTtcclxuXHJcbiAgICAgICAgZmlsZS5idWlsZHMuZm9yRWFjaCgoYnVpbGROYW1lKTogdm9pZCA9PiB7XHJcblxyXG4gICAgICAgICAgICBpZiAoYnVpbGRzICE9PSBudWxsICYmIGJ1aWxkcy5pbmRleE9mKGJ1aWxkTmFtZSkgPT09IC0xKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgYnVpbGQgPSBjb25maWcuZ2V0QnVpbGQoYnVpbGROYW1lKTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgbGV0IG91dHB1dERpcmVjdG9yeSA9IGJ1aWxkLm91dERpciA/IGJ1aWxkLm91dERpciA6IHBhdGguZGlybmFtZShvdXRwdXQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGJ1aWxkLm91dERpclZlcnNpb25pbmcpXHJcbiAgICAgICAgICAgICAgICBvdXRwdXREaXJlY3RvcnkgKz0gJy8nICsgY29uZmlnLmdldE91dERpclZlcnNpb24oKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChidWlsZC5vdXREaXJOYW1lKVxyXG4gICAgICAgICAgICAgICAgb3V0cHV0RGlyZWN0b3J5ICs9ICcvJyArIGNvbmZpZy5nZXRPdXREaXJOYW1lKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBzd2l0Y2ggKG91dHB1dEV4dGVudGlvbikge1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ2Nzcyc6XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1aWxkLmNzcy5vdXREaXJTdWZmaXgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERpcmVjdG9yeSArPSAnLycgKyBidWlsZC5jc3Mub3V0RGlyU3VmZml4O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdqcyc6IFxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChidWlsZC5qcy5vdXREaXJTdWZmaXgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERpcmVjdG9yeSArPSAnLycgKyBidWlsZC5qcy5vdXREaXJTdWZmaXg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoYnVpbGQudHMuY29tcGlsZXJPcHRpb25zLmRlY2xhcmF0aW9uID09PSB0cnVlKVxyXG4gICAgICAgICAgICAgICAgY3JlYXRlVHlwZVNjcmlwdERlY2xhcmF0aW9uKGZpbGUuaW5wdXQsIG91dHB1dERpcmVjdG9yeSwgb3V0cHV0RmlsZU5hbWUsIGJ1aWxkKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3MgPSBidW5kbGUoZmlsZS5pbnB1dCwgYnVpbGQpXHJcbiAgICAgICAgICAgIC5waXBlKGd1bHBDb25jYXQoJ2VtcHR5JykpXHJcbiAgICAgICAgICAgIC5waXBlKGd1bHBSZW5hbWUob3V0cHV0RmlsZU5hbWUpKVxyXG4gICAgICAgICAgICAucGlwZShndWxwLmRlc3Qob3V0cHV0RGlyZWN0b3J5KSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBzd2l0Y2ggKG91dHB1dEV4dGVudGlvbikge1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ2Nzcyc6XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1aWxkLmNzcy5taW5pZnkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3MucGlwZShndWxwQ2xlYW5DU1MoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnBpcGUoZ3VscFJlbmFtZSh7c3VmZml4OiBcIi5taW5cIn0pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucGlwZShndWxwLmRlc3Qob3V0cHV0RGlyZWN0b3J5KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ2pzJzogXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYnVpbGQuanMubWluaWZ5KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLnBpcGUoZ3VscFVnbGlmeSgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucGlwZShndWxwUmVuYW1lKHtzdWZmaXg6IFwiLm1pblwifSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5waXBlKGd1bHAuZGVzdChvdXRwdXREaXJlY3RvcnkpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbn0iXX0=
